# RamuneBot

## 概要

ほぼ自分専用のBotです  
音楽の再生、ダイスロールなどの機能を備えています  
導入URL: なし

## 使用している主なライブラリ等

- Node.js
- Discord.js
- ytdl

## 動かし方

1. クローンする
1. `npm i`を実行
1. .envの`DISCORD_TOKEN`にトークンを入れる
1. `npm run start`

## 機能

### スラッシュコマンド

- /call
    - メッセージタイプ:一時的
> システムチャンネルに通話に招待するメッセージを送る
- /dice roll `<コマンド>`  `<[ゲームシステム]>` `[<メッセージタイプ>]`
    - メッセージタイプ:選択可
> `<コマンド>`で入力したダイスコマンドを実行する
- /dice setquickdice `<コマンド>` `<[ゲームシステム]>`
    - メッセージタイプ:一時的
> `<コマンド>`で指定したダイスコマンドをクイックダイスに登録する
> クイックダイスはメッセージで`qd`と打つと実行できる
> 定時間後に登録解除される
- /dice gamesystemhelp `<ゲームシステム>` `[<メッセージタイプ>]`
    - メッセージタイプ:選択可
> 指定したゲームシステムのヘルプを表示する
- /dice dicetable
    - メッセージタイプ:通常
> ダイステーブル表を実行する
- /dice bigdice `<ダイスの個数(x)>` `<ダイスの面数(y)>`
    - メッセージタイプ:選択可
> xDyの形式でダイスを振る
> 巨大な数に対応しているがx×yが9007199254740991より大きいときに失敗することがある
- /earthquake
    - メッセージタイプ:一時的
> 直近20件の地震一覧を表示する
- /geticon `<ユーザー>`
    - メッセージタイプ:一時的
> 指定したユーザーのアイコンを表示する
- /ping
    - メッセージタイプ:一時的
> pingなどの情報を表示する
- /playmusic youtube `<YoutubeURL>` `<ループOnOff>` `[<メッセージタイプ>]`
    - メッセージタイプ:選択可
> `<YoutubeURL>`の動画をボイスチャンネルで再生する
> どこかしらのボイスチャンネルに参加しないと再生できない
- /playmusic youtubeplaylist `<YoutubeプレイリストURL>` `[<メッセージタイプ>]`
    - メッセージタイプ:選択可
> `<YoutubeプレイリストURL>`のプレイリストをボイスチャンネルで順番に再生する
> どこかしらのボイスチャンネルに参加しないと再生できない
- /poll `<タイトル>` `<タイプ>` `<選択股>`
    - メッセージタイプ:通常
> 投票など用のメッセージを送信する
> 選択肢は `選択肢1&選択肢2&選択肢3` のように`&`(半角)で区切る
- /おみくじ
    - メッセージタイプ:一時的
> おみくじを引く
> 大吉、吉、中吉、小吉、末吉、凶、大凶がある
- /channelregister calllogchannel `[<通話ログを送信するチャンネル>]`
    - メッセージタイプ:一時的
    - 実行可能:ギルド内のみ
    - 必要権限:サーバー管理(上書き可)
> そのギルドでの通話ログを送信するチャンネルを指定する
> チャンネル指定を空にすると解除する
- ~~/channelregister eewnoticechannel `[<地震情報を送信するチャンネル>]`~~
    - メッセージタイプ:一時的
    - 実行可能:ギルド内のみ
    - 必要権限:サーバー管理(上書き可)
> そのギルドでの地震情報を送信するチャンネルを指定する
> チャンネル指定を空にすると解除する

### メッセージコンテキストメニュー

- Zalgo
    - メッセージタイプ:一時的
> メッセージをzalgo化したものを表示する
> アルファベットがものすごいことになる
- コードブロックで表示
    - メッセージタイプ:一時的
> メッセージをコードブロックで表示する
> メッセージの原文を表示できる
> メッセージ内にコードブロックが含まれているとすこしバグる

### その他機能

#### ダイスロール

通常メッセージでダイスコマンドを送るか`/dice roll`でダイスロールできます  
環境変数で`DICE_GAS_URL`を設定することで特定のGoogle Apps Scriptに送信ができます(100面ダイス、通常メッセージのみ)  
↓スプレッドシートにユーザー名と1d100の出目を書き込む例  
```js
function doPost(e) {
  const data = JSON.parse(e.postData.contents)
  const username = data.username
  const rands = data.rands

  //usernameがstring以外でrandsがarray以外だったら処理しない
  if (!(typeof username === 'string') || !Array.isArray(rands)) {
    return
  }
  const sheet = SpreadsheetApp.openById("スプレッドシートIDをここに入力")
  rands.forEach(rand => {
    sheet.appendRow([username, rand, Utilities.formatDate(new Date(), 'Asia/Tokyo', 'yyyy/MM/dd HH:mm:ss')])
  })
}
```

#### 通話ログ

/channelregister calllogchannel `[<通話ログを送信するチャンネル>]` で設定可能  
参加メッセージ: `@ユーザーメンション(@ユーザーID) が⁠#チャンネルメンション に参加しました`  
退出メッセージ: `@ユーザーメンション(@ユーザーID) が⁠#チャンネルメンション から切断しました`  
移動メッセージ: `@ユーザーメンション(@ユーザーID) が⁠#チャンネルメンション1 から #⁠チャンネルメンション2 に移動しました`  

#### 地震通知

~~/channelregister eewnoticechannel `[<地震情報を送信するチャンネル>]` で設定可能~~ 
